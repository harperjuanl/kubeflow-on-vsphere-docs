<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kubeflow Installation &mdash; Kubeflow on vSphere 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Model Serving" href="model-serving.html" />
    <link rel="prev" title="Prerequisite (Kubernetes Cluster Prepartion)" href="prerequisite.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Kubeflow on vSphere
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="prerequisite.html">Prerequisite (Kubernetes Cluster Prepartion)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Kubeflow Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#deploy-on-vsphere-with-tanzu">Deploy on vSphere with Tanzu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploy-on-openshift">Deploy on OpenShift</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#check-kubeflow-requirements">Check kubeflow requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workflow-to-deploy-kubeflow-on-openshift">Workflow to deploy Kubeflow on OpenShift</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model-serving.html">Model Serving</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Kubeflow on vSphere</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Kubeflow Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="kubeflow-installation">
<h1>Kubeflow Installation<a class="headerlink" href="#kubeflow-installation" title="Permalink to this headline"></a></h1>
<div class="section" id="deploy-on-vsphere-with-tanzu">
<h2>Deploy on vSphere with Tanzu<a class="headerlink" href="#deploy-on-vsphere-with-tanzu" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><p>Use the following commands to set the default storage class. Skip this step if the default storage class has been set.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="gp">#</span> https://anthonyspiteri.net/tanzu-no-default-storageclass/
<span class="lineno"> 2 </span><span class="gp">$</span> kubectl config use-context liuqi
<span class="lineno"> 3 </span><span class="gp">$</span> kubectl edit tanzukubernetescluster tkgs-cluster-16
<span class="lineno"> 4 </span><span class="gp">#</span> add the following content under spec/settings <span class="o">(</span>same level as network setting<span class="o">)</span>
<span class="lineno"> 5 </span><span class="go">...</span>
<span class="lineno"> 6 </span><span class="go">storage:</span>
<span class="lineno"> 7 </span><span class="go">  defaultClass: pacific-storage-policy</span>
<span class="lineno"> 8 </span><span class="go">...</span>
<span class="lineno"> 9 </span><span class="gp">$</span> kubectl config use-context tkgs-cluster-16
<span class="lineno">10 </span><span class="gp">$</span> kubectl get sc
</pre></div>
</div>
</li>
<li><p>Use the following commands to add the fstype parmeter to workaround PVC issue. Skip this step if this has been done.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="gp">#</span> https://bugzilla.eng.vmware.com/show_bug.cgi?id<span class="o">=</span><span class="m">2764622</span>
<span class="lineno">2 </span><span class="gp">$</span> kubectl vsphere login --server<span class="o">=</span><span class="m">10</span>.117.233.1 --vsphere-username administrator@vsphere.local --insecure-skip-tls-verify --tanzu-kubernetes-cluster-namespace<span class="o">=</span>liuqi --tanzu-kubernetes-cluster-name<span class="o">=</span>tkgs-cluster-33
<span class="lineno">3 </span><span class="gp">$</span> kubectl get sc pacific-storage-policy -o yaml &gt; tmp-sc.yaml
<span class="lineno">4 </span><span class="gp">$</span> sed <span class="s1">&#39;/^parameters:.*/a\ \ csi.storage.k8s.io/fstype: &quot;ext4&quot;&#39;</span> -i tmp-sc.yaml
<span class="lineno">5 </span><span class="gp">$</span> kubectl replace -f tmp-sc.yaml --force
</pre></div>
</div>
</li>
<li><p>Patch PSP</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="gp">$</span> cat &lt;&lt; EOF <span class="p">|</span> kubectl apply -f -
<span class="lineno"> 2 </span><span class="go">apiVersion: v1</span>
<span class="lineno"> 3 </span><span class="go">kind: Namespace</span>
<span class="lineno"> 4 </span><span class="go">metadata:</span>
<span class="lineno"> 5 </span><span class="go">  name: auth</span>
<span class="lineno"> 6 </span><span class="go">---</span>
<span class="lineno"> 7 </span><span class="go">kind: RoleBinding</span>
<span class="lineno"> 8 </span><span class="go">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="lineno"> 9 </span><span class="go">metadata:</span>
<span class="lineno">10 </span><span class="go">  name: rb-all-sa_ns-auth</span>
<span class="lineno">11 </span><span class="go">  namespace: auth</span>
<span class="lineno">12 </span><span class="go">roleRef:</span>
<span class="lineno">13 </span><span class="go">  kind: ClusterRole</span>
<span class="lineno">14 </span><span class="go">  name: psp:vmware-system-privileged</span>
<span class="lineno">15 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">16 </span><span class="go">subjects:</span>
<span class="lineno">17 </span><span class="go">- kind: Group</span>
<span class="lineno">18 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">19 </span><span class="go">  name: system:serviceaccounts:auth</span>
<span class="lineno">20 </span><span class="go">---</span>
<span class="lineno">21 </span><span class="go">apiVersion: v1</span>
<span class="lineno">22 </span><span class="go">kind: Namespace</span>
<span class="lineno">23 </span><span class="go">metadata:</span>
<span class="lineno">24 </span><span class="go">  name: cert-manager</span>
<span class="lineno">25 </span><span class="go">---</span>
<span class="lineno">26 </span><span class="go">kind: RoleBinding</span>
<span class="lineno">27 </span><span class="go">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="lineno">28 </span><span class="go">metadata:</span>
<span class="lineno">29 </span><span class="go">  name: rb-all-sa_ns-cert-manager</span>
<span class="lineno">30 </span><span class="go">  namespace: cert-manager</span>
<span class="lineno">31 </span><span class="go">roleRef:</span>
<span class="lineno">32 </span><span class="go">  kind: ClusterRole</span>
<span class="lineno">33 </span><span class="go">  name: psp:vmware-system-privileged</span>
<span class="lineno">34 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">35 </span><span class="go">subjects:</span>
<span class="lineno">36 </span><span class="go">- kind: Group</span>
<span class="lineno">37 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">38 </span><span class="go">  name: system:serviceaccounts:cert-manager</span>
<span class="lineno">39 </span><span class="go">---</span>
<span class="lineno">40 </span><span class="go">apiVersion: v1</span>
<span class="lineno">41 </span><span class="go">kind: Namespace</span>
<span class="lineno">42 </span><span class="go">metadata:</span>
<span class="lineno">43 </span><span class="go">  name: istio-system</span>
<span class="lineno">44 </span><span class="go">---</span>
<span class="lineno">45 </span><span class="go">kind: RoleBinding</span>
<span class="lineno">46 </span><span class="go">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="lineno">47 </span><span class="go">metadata:</span>
<span class="lineno">48 </span><span class="go">  name: rb-all-sa_ns-istio-system</span>
<span class="lineno">49 </span><span class="go">  namespace: istio-system</span>
<span class="lineno">50 </span><span class="go">roleRef:</span>
<span class="lineno">51 </span><span class="go">  kind: ClusterRole</span>
<span class="lineno">52 </span><span class="go">  name: psp:vmware-system-privileged</span>
<span class="lineno">53 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">54 </span><span class="go">subjects:</span>
<span class="lineno">55 </span><span class="go">- kind: Group</span>
<span class="lineno">56 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">57 </span><span class="go">  name: system:serviceaccounts:istio-system</span>
<span class="lineno">58 </span><span class="go">---</span>
<span class="lineno">59 </span><span class="go">apiVersion: v1</span>
<span class="lineno">60 </span><span class="go">kind: Namespace</span>
<span class="lineno">61 </span><span class="go">metadata:</span>
<span class="lineno">62 </span><span class="go">  name: knative-serving</span>
<span class="lineno">63 </span><span class="go">---</span>
<span class="lineno">64 </span><span class="go">kind: RoleBinding</span>
<span class="lineno">65 </span><span class="go">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="lineno">66 </span><span class="go">metadata:</span>
<span class="lineno">67 </span><span class="go">  name: rb-all-sa_ns-knative-serving</span>
<span class="lineno">68 </span><span class="go">  namespace: knative-serving</span>
<span class="lineno">69 </span><span class="go">roleRef:</span>
<span class="lineno">70 </span><span class="go">  kind: ClusterRole</span>
<span class="lineno">71 </span><span class="go">  name: psp:vmware-system-privileged</span>
<span class="lineno">72 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">73 </span><span class="go">subjects:</span>
<span class="lineno">74 </span><span class="go">- kind: Group</span>
<span class="lineno">75 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">76 </span><span class="go">  name: system:serviceaccounts:knative-serving</span>
<span class="lineno">77 </span><span class="go">---</span>
<span class="lineno">78 </span><span class="go">apiVersion: v1</span>
<span class="lineno">79 </span><span class="go">kind: Namespace</span>
<span class="lineno">80 </span><span class="go">metadata:</span>
<span class="lineno">81 </span><span class="go">  name: kubeflow</span>
<span class="lineno">82 </span><span class="go">  labels:</span>
<span class="lineno">83 </span><span class="go">    control-plane: kubeflow</span>
<span class="lineno">84 </span><span class="go">    istio-injection: enabled</span>
<span class="lineno">85 </span><span class="go">---</span>
<span class="lineno">86 </span><span class="go">kind: RoleBinding</span>
<span class="lineno">87 </span><span class="go">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="lineno">88 </span><span class="go">metadata:</span>
<span class="lineno">89 </span><span class="go">  name: rb-all-sa_ns-kubeflow</span>
<span class="lineno">90 </span><span class="go">  namespace: kubeflow</span>
<span class="lineno">91 </span><span class="go">roleRef:</span>
<span class="lineno">92 </span><span class="go">  kind: ClusterRole</span>
<span class="lineno">93 </span><span class="go">  name: psp:vmware-system-privileged</span>
<span class="lineno">94 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">95 </span><span class="go">subjects:</span>
<span class="lineno">96 </span><span class="go">- kind: Group</span>
<span class="lineno">97 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">98 </span><span class="go">  name: system:serviceaccounts:kubeflow</span>
<span class="lineno">99 </span><span class="go">EOF</span>
</pre></div>
</div>
</li>
<li><p>Deploy Kubeflow step by step using the note <a class="reference external" href="https://github.com/kubeflow/manifests/tree/v1.4-branch#install-individual-components">here</a></p></li>
<li><p>Fix PSP issues for example namespace</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="gp">$</span> cat &lt;&lt; EOF <span class="p">|</span> kubectl apply -f -
<span class="lineno"> 2 </span><span class="go">kind: RoleBinding</span>
<span class="lineno"> 3 </span><span class="go">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="lineno"> 4 </span><span class="go">metadata:</span>
<span class="lineno"> 5 </span><span class="go">  name: rb-all-sa_ns-kubeflow-user-example-com</span>
<span class="lineno"> 6 </span><span class="go">  namespace: kubeflow-user-example-com</span>
<span class="lineno"> 7 </span><span class="go">roleRef:</span>
<span class="lineno"> 8 </span><span class="go">  kind: ClusterRole</span>
<span class="lineno"> 9 </span><span class="go">  name: psp:vmware-system-privileged</span>
<span class="lineno">10 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">11 </span><span class="go">subjects:</span>
<span class="lineno">12 </span><span class="go">- kind: Group</span>
<span class="lineno">13 </span><span class="go">  apiGroup: rbac.authorization.k8s.io</span>
<span class="lineno">14 </span><span class="go">  name: system:serviceaccounts:kubeflow-user-example-com</span>
<span class="lineno">15 </span><span class="go">EOF</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="deploy-on-openshift">
<h2>Deploy on OpenShift<a class="headerlink" href="#deploy-on-openshift" title="Permalink to this headline"></a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://v1-3-branch.kubeflow.org/docs/distributions/openshift/install-kubeflow/">Kubeflow 1.4 Installing on OpenShift</a></p>
</div>
<div class="section" id="check-kubeflow-requirements">
<h3>Check kubeflow requirements<a class="headerlink" href="#check-kubeflow-requirements" title="Permalink to this headline"></a></h3>
<p>Code Ready Containers Resources:
If you are using Code Ready Containers, you need to make sure you have enough resources configured for the VM:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="gp">#</span> Recommended: <span class="o">(</span>to check every openshift node resouces.<span class="o">)</span>
<span class="lineno"> 2 </span><span class="go">16 GB memory</span>
<span class="lineno"> 3 </span><span class="go">6 CPU</span>
<span class="lineno"> 4 </span><span class="go">45 GB disk space</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="gp">#</span> Minimal:
<span class="lineno"> 8 </span><span class="go">10 GB memory</span>
<span class="lineno"> 9 </span><span class="go">6 CPU</span>
<span class="lineno">10 </span><span class="go">30 GB disk space (default for CRC)</span>
</pre></div>
</div>
</div>
<div class="section" id="workflow-to-deploy-kubeflow-on-openshift">
<h3>Workflow to deploy Kubeflow on OpenShift<a class="headerlink" href="#workflow-to-deploy-kubeflow-on-openshift" title="Permalink to this headline"></a></h3>
<p><strong>Please read Kubeflow Installing on OpenShift this websit and this page to deploy OpenShift</strong></p>
<ol class="arabic">
<li><p>Clone the <a class="reference external" href="https://github.com/opendatahub-io/manifests">opendatahub/manifests</a> repository. This repository defaults to the v1.3-branch-openshift branch. But we need to deploy kubeflow 1.4 and there is no v1.4-branch kubeflow branch，so you need to <a class="reference external" href="https://github.com/AmyHoney/kubeflow-1.4">yourself kubeflow 1.4 repo</a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="go">git clone https://github.com/AmyHoney/kubeflow-1.4</span>
<span class="lineno">2 </span><span class="go">cd manifests</span>
</pre></div>
</div>
</li>
<li><p>Build the deployment configuration using the OpenShift KFDef file and local downloaded manifests</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="gp">#</span> update the manifest repo URI
<span class="lineno"> 2 </span><span class="go">sed -i &#39;s#uri: .*#uri: &#39;$PWD&#39;#&#39; ./kfdef/kfctl_openshift.yaml</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="gp">#</span> <span class="nb">set</span> the Kubeflow application diretory <span class="k">for</span> this deployment, <span class="k">for</span> example /opt/openshift-kfdef
<span class="lineno"> 5 </span><span class="go">export KF_DIR=&lt;path-to-kfdef&gt;</span>
<span class="lineno"> 6 </span><span class="go">mkdir -p ${KF_DIR}</span>
<span class="lineno"> 7 </span><span class="go">cp ./kfdef/kfctl_openshift.yaml ${KF_DIR}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="gp">#</span> build deployment configuration
<span class="lineno">10 </span><span class="go">cd ${KF_DIR}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="gp">[vcp@mlops-oss openshift-kfdef]$</span> kfctl build --file<span class="o">=</span>kfctl_openshift.yaml
<span class="lineno">13 </span><span class="gp">[vcp@mlops-oss openshift-kfdef]$</span> ls
<span class="lineno">14 </span><span class="go">kfctl_openshift.yaml  kustomize</span>
</pre></div>
</div>
</li>
<li><p>Apply the generated deployment configuration.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="go">kfctl apply --file=kfctl_openshift.yaml</span>
</pre></div>
</div>
</li>
<li><p>Wait until all the pods are running in kubeflow namespace.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="go">oc get pods -n kubeflow</span>
<span class="lineno">2 </span><span class="go">NAME                                                           READY   STATUS    RESTARTS   AGE</span>
<span class="lineno">3 </span><span class="go">argo-ui-7f79c9ccbc-vxqgx                                       1/1     Running   0          7m55s</span>
<span class="lineno">4 </span><span class="go">centraldashboard-65d87fb769-d8l5g                              1/1     Running   0          7m55s</span>
<span class="lineno">5 </span><span class="go">jupyter-web-app-deployment-6748fc47cc-78hr4                    1/1     Running   0          7m</span>
<span class="lineno">6 </span><span class="go">katib-controller-7dd757bdf-wmg2t                               1/1     Running   1          6m57s</span>
<span class="lineno">7 </span><span class="go">.......</span>
</pre></div>
</div>
</li>
<li><p>The command below looks up the URL of the Kubeflow user interface assigned by the OpenShift cluster. You can open the printed URL in your browser to access the Kubeflow user interface.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="gp">#</span> get kubeflow ui website as follow
<span class="lineno">2 </span><span class="go">oc get routes -n istio-system istio-ingressgateway -o jsonpath=&#39;http://{.spec.host}/&#39;</span>
<span class="lineno">3 </span><span class="go">http://istio-ingressgateway-istio-system.apps.ocp4-cluster-001.liuqi.io/</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/AmyHoney/kubeflow-1.4">Kubeflow 1.4 gitlab code</a></p></li>
<li><p><a class="reference external" href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/3.11/html/installing_clusters/setting-proxy-overrides">Set openshift proxy</a></p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="prerequisite.html" class="btn btn-neutral float-left" title="Prerequisite (Kubernetes Cluster Prepartion)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model-serving.html" class="btn btn-neutral float-right" title="Model Serving" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, VMware.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>